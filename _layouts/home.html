---
layout: default
---

{% include site-header.html %}

<main class="main  container">

	<div class="content">

    <article class="article  article--page  typeset">

			{% assign collectiondata = site.collections | where: "label", page.collectionpage | first %}
			<h1>drinkcheap</h1>

    </article>

    <ul class="list  list--posts">
    {% for page in site.posts %}
      <li class="item  item--post" data-day="{{ page.day }}" data-start="{{ page.start }}" data-end="{{ page.end }}" data-recurring="{{ page.recurring }}" data-title="{{ page.title }}">
        <article class="article  article--post  typeset">

          <h2><a href="{{ site.baseurl }}{{ page.url }}">{{ page.title }}</a></h2>
          {{ page.excerpt | markdownify | truncatewords: 60 }}

        </article>
      </li>
    {% endfor %}
  </ul>
  </div>
</main>

<script>
    function filterPosts() {
        const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
        const now = new Date();
        const currDay = days[now.getDay()];
        const currTime = `${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

        // We have current day (eg Sunday) and time (eg 17:45:00)

        const list = document.querySelector('.list.list--posts');
        const items = Array.from(list.getElementsByTagName('li'));

        function timeToMinutes(timeStr) {
                var [hours, minutes, seconds] = timeStr.split(':').map(Number);
                return hours * 60 + minutes;
        }

        function distanceFromNow(post) {
            var postStartDay = post.getAttribute('data-day');
            var postStart = post.getAttribute('data-start');
            var postEnd = post.getAttribute('data-end');
            var postEndDay = postStartDay;
            var postTitle = post.getAttribute('data-title');
            var happeningNow = false;

            // if it goes to next day
            if (postStart > postEnd) {
                postEndDay = days[(1 + days.indexOf(postStartDay)) % 7]
            }

            // get distance from reference - Sunday 00:00:00
            distanceNow = days.indexOf(currDay) * 24 * 60 + timeToMinutes(currTime);
            distancePostStart = days.indexOf(postStartDay) * 24 * 60 + timeToMinutes(postStart);
            distancePostEnd = days.indexOf(postEndDay) * 24 * 60 + timeToMinutes(postEnd);

            // check if event is happening
            if (distancePostStart <= distancePostEnd) {
                happeningNow = distanceNow >= distancePostStart && distanceNow <= distancePostEnd;
            } else {
                happeningNow = distanceNow >= distancePostStart || distanceNow <= distancePostEnd;
            }

            console.log(postTitle);
            console.log(happeningNow);
            console.log(distanceNow);
            console.log(distancePostStart);
            console.log(distancePostEnd);

            // calculate distance from now
            if (happeningNow) {
                return -10080;
            } else {
                // past
                if ((distanceNow > distancePostEnd && distancePostStart <= distancePostEnd) || (distancePostStart > distancePostEnd && distanceNow > distancePostEnd && distanceNow < distancePostStart)) {
                    return (10080 - distanceNow) + distancePostStart;
                } else {
                    //future
                    if (distanceNow < distancePostStart) {
                        return (distancePostStart - distanceNow);
                    }
                    else {
                        return (10080 - distanceNow) + distancePostStart;
                    }
                }
            }

        }

        items.sort((a, b) => {
            distanceFromNow(a) - distanceFromNow(b);
      });

        list.innerHTML = '';
        items.forEach(item => list.appendChild(item));

        const posts = document.querySelectorAll('.item--post');
        const collectionTitle = document.title;
        var posted = 0;

        posts.forEach(post => {
            var happeningNow = distanceFromNow(post) == -10080;

            if (post.getAttribute('data-recurring') == "true") {
                if (collectionTitle === "drinkcheap - drinkcheap") {
                    if (!happeningNow) {
                        post.style.display = 'none';
                    } else {
                        posted++;
                    }
                } else if (collectionTitle == "upcoming - drinkcheap") {
                    if(happeningNow) {
                        post.style.display = 'none';
                    } else {
                        posted++;
                    }
                } 
            }
        });

        if (posted == 0) {
        	const message = document.createElement('p');
        	message.style.marginTop = '50px';
        	message.textContent = 'No upcoming listings right now';
        	if (document.title == "drinkcheap - drinkcheap") {
        		message.textContent = 'No active listings today. Please check the upcoming section. Thanks!'
        	}

        	message.style.color = '#5B5BFF'; // Optional: style the message

	        // Insert the message into the DOM
	        const contentDiv = document.querySelector('.content');
	        contentDiv.appendChild(message);

        }
    };

    document.addEventListener("DOMContentLoaded", filterPosts);
    window.addEventListener("popstate", filterPosts);
    window.addEventListener("hashchange", filterPosts);
</script>

{% include site-footer.html %}
