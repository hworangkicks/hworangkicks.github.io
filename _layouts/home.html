---
layout: default
---

{% include site-header.html %}

<main class="main  container">

	<div class="content">

    <article class="article  article--page  typeset">

			{% assign collectiondata = site.collections | where: "label", page.collectionpage | first %}
			<h1>drinkcheap</h1>

    </article>

    <ul class="list  list--posts">
    {% for page in site.posts %}
      <li class="item  item--post" data-day="{{ page.day }}" data-start="{{ page.start }}" data-end="{{ page.end }}" data-recurring="{{ page.recurring }}" data-title="{{ page.title }}">
        <article class="article  article--post  typeset">

          <h2><a href="{{ site.baseurl }}{{ page.url }}">{{ page.title }}</a></h2>
          {{ page.excerpt | markdownify | truncatewords: 60 }}

        </article>
      </li>
    {% endfor %}
  </ul>
  </div>
</main>

<script>
    function filterPosts() {
        const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
        const now = new Date();
        const currentDay = days[now.getDay()];
        const currTime = `${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

        // We have current day (eg Sunday) and time (eg 17:45:00)

        const list = document.querySelector('.list.list--posts');
        const items = Array.from(list.getElementsByTagName('li'));

        function distanceFromNow(post) {
            var minutesFromNow = 0;

            var postDay = post.getAttribute('data-day');
            var postStart = post.getAttribute('data-start');
            var postEnd = post.getAttribute('data-end');

            var dayDifference = (days.indexOf(postDay) - days.indexOf(currentDay) + 7) % 7;
            minutesFromNow += dayDifference * 24 * 60;

            function timeToMinutes(timeStr) {
                var [hours, minutes, seconds] = timeStr.split(':').map(Number);
                return hours * 60 + minutes + (seconds / 60);
            }

            var currentTimeMinutes = timeToMinutes(currTime);
            var postStartMinutes = timeToMinutes(postStart);
            var postEndMinutes = timeToMinutes(postEnd);

            var isHappeningNow = (postDay === currentDay) && (currentTimeMinutes >= postStartMinutes && currentTimeMinutes <= postEndMinutes);

            post.setAttribute('data-happening-now', isHappeningNow ? 'true' : 'false');

            var timeDifferenceStart = postStartMinutes - currentTimeMinutes;
            var timeDifferenceEnd = postEndMinutes - currentTimeMinutes;

            if (timeDifferenceStart > 0) {
                minutesFromNow += timeDifferenceStart;
                } else if (timeDifferenceEnd > 0) {
                    minutesFromNow += timeDifferenceEnd;
                } else {
                // Event is already over
                    minutesFromNow = 7 * 23 * 60 + (currentTimeMinutes - postEndMinutes);
                 }

            return minutesFromNow;
        }

        items.sort((a, b) => {
            distanceA = distanceFromNow(a);
            distanceB = distanceFromNow(b);

            return distanceA - distanceB;
      });

        list.innerHTML = '';
        items.forEach(item => list.appendChild(item));
        var currentTimeMinutes = timeToMinutes(currentTime);

        const posts = document.querySelectorAll('.item--post');
        const collectionTitle = document.title;
        var posted = 0;

        posts.forEach(post => {
            if (post.getAttribute('data-recurring') == "true") {
                if (collectionTitle === "drinkcheap - drinkcheap") {
                    if (!post.getAttribute('data-happening-now')) {
                        post.style.display = 'none';
                    } else {
                        posted++;
                    }
                } else if (collectionTitle == "upcoming - drinkcheap") {
                    if(post.getAttribute('data-happening-now')) {
                        post.style.display = 'none';
                    } else {
                        posted++;
                    }
                } 
            }
        });

        if (posted == 0) {
        	const message = document.createElement('p');
        	message.style.marginTop = '50px';
        	message.textContent = 'No upcoming listings right now';
        	if (document.title == "drinkcheap - drinkcheap") {
        		message.textContent = 'No active listings today. Please check the upcoming section. Thanks!'
        	}

        	message.style.color = '#5B5BFF'; // Optional: style the message

	        // Insert the message into the DOM
	        const contentDiv = document.querySelector('.content');
	        contentDiv.appendChild(message);

        }
    };

    document.addEventListener("DOMContentLoaded", filterPosts);
    window.addEventListener("popstate", filterPosts);
    window.addEventListener("hashchange", filterPosts);
</script>

{% include site-footer.html %}
